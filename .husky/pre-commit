#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit security checks..."

# 1. Run security validation script
echo "ğŸ“‹ Running comprehensive security validation..."
node scripts/security-check.mjs

# 2. Check for secrets in staged files
echo "ğŸ•µï¸ Checking for exposed secrets..."
git diff --cached --name-only | xargs -I {} sh -c 'echo "Checking: {}"; grep -E "(password|secret|key|token)" {} || true'

# 3. Run lint-staged for code quality
echo "ğŸ” Running code quality checks..."
pnpm lint-staged

# 4. Type checking
echo "ğŸ“ Running TypeScript checks..."
pnpm type-check

# 5. Run tests if they exist
if [ -f "package.json" ] && grep -q '"test"' package.json; then
  echo "ğŸ§ª Running tests..."
  pnpm test --passWithNoTests
fi

echo "âœ… Pre-commit security checks completed successfully!"